<!DOCTYPE html>
<html>
<head>
    <title>CSV Host Check</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />

    <style>
        .success-cell { background-color: #c8f7c5; font-weight: bold; } /* green */
        .fail-cell { background-color: #f7c5c5; font-weight: bold; }    /* red */
    </style>
</head>

<body class="p-4">
    <h3 class="mb-3">Upload CSV & Check Host Status</h3>

    <input type="file" id="csvFile" class="form-control mb-3">
    <button class="btn btn-primary" onclick="processCSV()">Upload & Process</button>

    <hr>

    <table class="table table-bordered table-striped mt-3" id="resultTable">
        <thead class="table-dark">
            <tr>
                <th>Hostname</th>
                <th>SNMP Name</th>
                <th>API1 Status</th>
                <th>API2 Status</th>
                <th>API3 Status</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

<script>
function processCSV() {
    const file = document.getElementById("csvFile").files[0];
    if (!file) { alert("Please upload CSV"); return; }

    const reader = new FileReader();
    reader.onload = function(event) {
        const lines = event.target.result.split("\n");

        lines.forEach(line => {
            if (!line.trim()) return;

            const [hostname, snmpname] = line.split(",");

            callAllApis(hostname.trim(), snmpname.trim());
        });
    };
    reader.readAsText(file);
}


async function callAllApis(host, snmp) {
    
    // ------- Parallel API Calls (Replace URLs with your API endpoints) -------
    const api1 = fetch("https://your-api1.com/check?host=" + host).then(r => r.ok);
    const api2 = fetch("https://your-api2.com/check?host=" + host).then(r => r.ok);
    const api3 = fetch("https://your-api3.com/check?host=" + host).then(r => r.ok);

    const results = await Promise.all([api1, api2, api3]);

    addRow(host, snmp, results);
}

function addRow(hostname, snmp, results) {
    const table = document.querySelector("#resultTable tbody");

    const row = document.createElement("tr");

    row.innerHTML = `
        <td>${hostname}</td>
        <td>${snmp}</td>
        <td class="${results[0] ? 'success-cell' : 'fail-cell'}">${results[0] ? 'Working' : 'Failed'}</td>
        <td class="${results[1] ? 'success-cell' : 'fail-cell'}">${results[1] ? 'Working' : 'Failed'}</td>
        <td class="${results[2] ? 'success-cell' : 'fail-cell'}">${results[2] ? 'Working' : 'Failed'}</td>
    `;

    table.appendChild(row);
}
</script>
</body>
</html>